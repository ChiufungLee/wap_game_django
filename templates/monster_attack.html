{% extends 'base.html' %}
{% block title %} è¿›å…¥æ¸¸æˆ {% endblock %}
{% load static %}

{% block content %}

<div id="content"></div>
{% if op_action == 'pre_attack' %}
ä½ å‘{{npc.name}}å‘èµ·äº†æ”»å‡»ï¼
<p></p>
<!-- <p><a href="">çŠ¶æ€</a> <a href="">è£…å¤‡</a> <a href="">é€ƒè·‘({{run_cost}}é“œå¸)</a></p> -->
<p>ä½ ç”Ÿå‘½ï¼š{{player.current_hp}}/{{player.max_hp}} </p>
<!-- <p>ä½ æ”»å‡»ï¼š{{player.min_attack}}-{{player.max_attack}}</p>
<p>ä½ é˜²å¾¡ï¼š{{player.min_defense}}-{{player.max_defense}}</p> -->
<p>ä½ çŠ¶æ€ï¼šä¸­æ¯’</p>
<p>----------------------</p>
<p>{{npc.name}}ç”Ÿå‘½ï¼š{{ npc.hp }}/{{ npc.hp }}</p>
<p>{{npc.name}}çŠ¶æ€ï¼šè™šå¼±</p>
<P>----------------------</P>

<p> {% for skill in player_skills %} <a href="/wap/?cmd={{skill.cmd_params}}">{{skill.name}}</a>{% endfor %} </p>


{% elif op_action == 'attack_monster' %}

{% if attack_result.skill_used %}
    <p>ä½ ä½¿ç”¨äº† {{ attack_result.skill_used }} æŠ€èƒ½ï¼</p>
{% else %}
    <p>ä½ å‘åŠ¨äº†æ™®é€šæ”»å‡»ï¼</p>
{% endif %}
<p>ä½ å¯¹[{{npc.name}}]é€ æˆäº† <span class="damage">{{ attack_result.player_damage }}</span> ç‚¹ä¼¤å®³ï¼</p>
<p>[{{npc.name}}]å¯¹ä½ é€ æˆäº† <span class="damage">{{ attack_result.monster_damage }}</span> ç‚¹ä¼¤å®³ï¼</p>
<!-- <p> <a href="">é€ƒè·‘(50é“œå¸)</a></p> -->
<p>ä½ ç”Ÿå‘½ï¼š{{player.current_hp}}/{{player.max_hp}} -{{ attack_result.monster_damage }}</p>
<p>ä½ æ”»å‡»ï¼š{{player.min_attack}}-{{player.max_attack}}</p>
<p>ä½ é˜²å¾¡ï¼š{{player.min_defense}}-{{player.max_defense}}</p>
<p>ä½ çŠ¶æ€ï¼šä¸­æ¯’</p>
<p>----------------------</p>
<p>[{{npc.name}}]ç”Ÿå‘½ï¼š{{ attack_result.remaining_hp }}/{{ npc.hp }}  -{{ attack_result.player_damage }}</p>
<p>[{{npc.name}}]çŠ¶æ€ï¼šè™šå¼±</p>

    {% if attack_result.remaining_hp > 0 %}
        
        
    {% else %}

    {% endif %}
<p> {% for skill in player_skills %} <a href="/wap/?cmd={{skill.cmd_params}}">{{skill.name}}</a>{% endfor %} </p>
    



<!-- <p><a href="">æ”»å‡»</a></p> -->
{% elif op_action == 'attack_result' %}
    {% if attack_result.killed %}

    {% if task_progresses %}
<div class="task-progress-section">
    <!-- <h3>ä»»åŠ¡è¿›åº¦æ›´æ–°</h3> -->
    {% for task in task_progresses %}
    <div class="task-item">
        <!-- <p>{{ task.task_name }}</p> -->
        <ul>

            <p>ä»»åŠ¡ï¼š{{ task.task_name }}
                {% if task.progress.target_type == 2 %}
                    å‡»æ€{{ task.progress.target_name }}: 
                {% elif task.progress.target_type == 1 %}
                    æ”¶é›†ç‰©å“{{ task.progress.target_id }}: 
                {% elif task.target_type == 3 %}
                    ä¸NPC #{{ task.progress.target_id }}å¯¹è¯: 
                {% else %}
                    æœªçŸ¥ç›®æ ‡ #{{ task.progress.target_id }}: 
                {% endif %}
                ({{ task.progress.current_count }}/{{ task.progress.required_count }})
            </p>
        </ul>
    </div>
    {% endfor %}
</div>
{% endif %}



        <div class="victory">
            <p>æˆåŠŸå‡»æ€äº† {{ npc.name }}</p>
            
            {% if reward_info %}
            <p>è·å¾—ç»éªŒ: +{{ reward_info.exp }}</p>
            <p>è·å¾—é‡‘é’±: +{{ reward_info.gold }} é‡‘å¸</p>
            
                {% if reward_info.loot %}
                    <p>æ‰è½ç‰©å“:
                    {% for item in attack_result.reward_info.loot %}
                       {{ item.name }} x{{ item.quantity }} ã€
                    {% endfor %}
                    </p>
                {% endif %}
            {% endif %}





    {% else %}
        {% if attack_result.player_died %}
            <div class="defeat">
                <h3>ğŸ’€ ä½ è¢« {{ npc.name }} å‡»è´¥äº†ï¼ ğŸ’€</h3>
                <p>ä½ å·²è¢«ä¼ é€åˆ°å®‰å…¨åŒºï¼Œå¹¶æ¢å¤äº†éƒ¨åˆ†ç”Ÿå‘½å€¼ã€‚</p>
                <p>å½“å‰ç”Ÿå‘½å€¼: {{ attack_result.player_current_hp }}/{{ player.max_hp }}</p>
                
                <div class="actions">
                <a href="/wap/?cmd={{ wap_encrypted_param }}" class="btn">è¿”å›å®‰å…¨åŒº</a>
                </div>
            </div>
        {% endif %}

    
    {% endif %}
   
{% else %}
{% endif %}


</div>


<a href="/wap/?cmd={{ wap_encrypted_param }}">è¿”å›æ¸¸æˆ</a>


{% endblock %}
